(function($){'use strict';TxDMV.Lpot.MyPlates.Web.Views.UrlService=function(applicationController){var options;var _designTypeIdLookup;var _designTypeSeoLookup;var _vehicleTypeIdLookup;var _vehicleTypeSeoLookup;var _familyIdLookup;var _familySeoLookup;var arrayHelper=TxDMV.Lpot.MyPlates.Web.Services.arrayHelper;var stringHelper=TxDMV.Lpot.MyPlates.Web.Services.stringHelper;function init(bindOptions){options=bindOptions;prepareData();}
function prepareData(){_designTypeIdLookup=arrayHelper.indexByUniqueProperty(options.designTypes,'id');_designTypeSeoLookup=arrayHelper.indexByUniqueProperty(options.designTypes,'seoName');_vehicleTypeIdLookup=arrayHelper.indexByUniqueProperty(options.vehicleTypes,'id');_vehicleTypeSeoLookup=arrayHelper.indexByUniqueProperty(options.vehicleTypes,'seoName');_familyIdLookup=arrayHelper.indexByUniqueProperty(options.microplateData,'id');_familySeoLookup=arrayHelper.indexByUniqueProperty(options.microplateData,'seoName');}
function getSettings(){var hrefParts=window.location.href.split('?');var parameterString=(hrefParts.length>1)?hrefParts[1]:'';var parameters=(parameterString.length===0)?[]:parameterString.split('&');var parts=window.location.pathname.split('/');var parseDesignTypeId=function(){var seoName=parseString(2);var item=_designTypeSeoLookup[seoName];return(item)?item.id:1;};var parseVehicleTypeId=function(){var seoName=parseString(3);var item=_vehicleTypeSeoLookup[seoName];return(item)?item.id:1;};var parsePlateFamilyId=function(){var seoName=parseString(4);var item=_familySeoLookup[seoName];return(item)?item.id:1;};var parseMessage=function(){return decodeURI(parseString(5));};var parseString=function(index){if(parts.length<(index+1))return'';return parts[index].toLowerCase();};var getParameterValue=function(parameterName){for(var i=0;i<parameters.length;i++){var parts=parameters[0].split('=');if(parts[0].toLowerCase()===parameterName)return(parts.length===1)?'':parts[1];}
return'';};var parseSearchString=function(){var value=getParameterValue('search');value=stringHelper.replaceAll(value,'+',' ');return decodeURIComponent(value);};var parseAttributeIds=function(){var value=getParameterValue('attributes');if(value.length===0)return[];value=stringHelper.replaceAll(value,'+',' ');var values=value.split(' ');var isIds=!isNaN(values[0]);return(isIds)?values:value;};var designTypeId=parseDesignTypeId();var vehicleTypeId=parseVehicleTypeId();var plateFamilyId=parsePlateFamilyId();return{pageName:parts[1],designTypeId:designTypeId,designType:_designTypeIdLookup[designTypeId].seoName,vehicleTypeId:vehicleTypeId,vehicleType:_vehicleTypeIdLookup[vehicleTypeId].seoName,plateFamilyId:plateFamilyId,plateFamily:_familyIdLookup[plateFamilyId].seoName,message:parseMessage(),searchString:parseSearchString(),attributes:parseAttributeIds()};}
function setUrl(urlSettings){var stringHelper=TxDMV.Lpot.MyPlates.Web.Services.stringHelper;var getIdParameter=function(parameterName,ids){if(!ids||ids.length===0||typeof ids==='string')return'';var value='';ids.forEach(function(id){if(value.length>0)value+='+';value+=id;});return parameterName+'='+value;};var getSearchParameter=function(){if(!urlSettings.searchString)return'';if(urlSettings.searchString.length===0)return'';var value=encodeURIComponent(urlSettings.searchString);value=stringHelper.replaceAll(value,'%20','+');return'search='+value;};var append=function(url,parameter){if(!parameter)return url;var joiner=(url.indexOf('?')===-1)?'?':'&';return url+joiner+parameter;};var isBackgroundOnly=urlSettings.designTypeId==2;var message=(isBackgroundOnly?'':'/'+encodeURI(urlSettings.message.toLowerCase()));var url='/'+urlSettings.pageName+'/'+urlSettings.designType+'/'+urlSettings.vehicleType+'/'+urlSettings.plateFamily+message;url=append(url,getSearchParameter());url=append(url,getIdParameter('attribute',urlSettings.attributes));window.history.replaceState('',options.browserTabTitle,url);}
function setMessage(message,urlSettings){urlSettings.message=message;setUrl(urlSettings);}
function setSearch(searchString,urlSettings){urlSettings.searchString=searchString;}
function setAttributes(attributes,urlSettings,allAreSelected){urlSettings.attributes=(allAreSelected)?[]:attributes;}
function setIdProperty(propertyName,id,urlSettings){urlSettings[propertyName]=id;var lookup;if(propertyName==='plateFamilyId'){lookup=_familyIdLookup;}
else if(propertyName==='vehicleTypeId'){lookup=_vehicleTypeIdLookup;}
else if(propertyName==='designTypeId'){lookup=_designTypeIdLookup;}
var rootPropertyName=propertyName.replace('Id','');urlSettings[rootPropertyName]=lookup[id].seoName;setUrl(urlSettings);}
function getPlate(urlSettings){var family=_familyIdLookup[urlSettings.plateFamilyId];var requiresPersonalized=urlSettings.designTypeId===1;var item;arrayHelper.sort(family.vehicleTypes,'maxCharacterLength');family.vehicleTypes.forEach(function(plate){if(plate.vehicleTypeId==urlSettings.vehicleTypeId){var isPersonalizable=plate.maxCharacterLength>0;if(requiresPersonalized&&isPersonalizable){item=plate;}
else if(!requiresPersonalized&&!isPersonalizable){item=plate;}}});return item;}
return{init:init,getSettings:getSettings,getPlate:getPlate,setMessage:setMessage,setSearch:setSearch,setAttributes:setAttributes,updateUrl:setUrl,setIdProperty:setIdProperty};};}(jQuery));