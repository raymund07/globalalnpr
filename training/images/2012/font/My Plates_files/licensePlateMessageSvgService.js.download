(function($){'use strict';TxDMV.Lpot.MyPlates.Web.Services.LicensePlateMessageSvgService=function(characterSvgService,licensePlateRepository){var characterSprite;var _characterSvgService=characterSvgService;var _licensePlateRepository=licensePlateRepository;function drawMessage(svg,familyID,vehicleTypeId,plateMessage){var plate=_licensePlateRepository.get(familyID,vehicleTypeId);if(plateMessage.length>(plate.byteCount1+plate.byteCount2)){plateMessage=plateMessage.substring(0,plate.byteCount1+plate.byteCount2);}
var x=Math.floor((plate.fieldWidth1/2+plate.fieldX1-208)*5);var plateSvg=Snap(svg);plateSvg.select('.field1').selectAll('*').remove();plateSvg.select('.field2').selectAll('*').remove();plateSvg.attr({style:'top: '+(34+((plate.fieldY-60)*0.4))+'%'});if(plate.dividedDesignFlag&&plateMessage.length>plate.byteCount1){var field1Characters=plateMessage.substring(0,plate.byteCount1);var field2Characters=plateMessage.substring(plate.byteCount1);drawMessageField(plateSvg.select('.field1'),field1Characters,plate.color1,plate.byteCount1,x);x=Math.floor((plate.fieldWidth2/2+plate.fieldX2-plate.fieldX1-208)*5.5);drawMessageField(plateSvg.select('.field2'),field2Characters,plate.color2,plate.byteCount2,x);}
else{drawMessageField(plateSvg.select('.field1'),plateMessage,plate.color1,plate.byteCount1,x);}}
function drawMessageField(plateCharacters,characters,color,byteCount,x){for(var i=0;i<characters.length;i++){var character=characters.toLowerCase().split('')[i];plateCharacters.append(_characterSvgService.getCharacterSvg(character));}
var currentCharacters=plateCharacters.selectAll('*');var setTotal=currentCharacters.length;var setCount=0;var maxCharacterWidth=156;var spaceWidth=58.5;var byteWidth=maxCharacterWidth+spaceWidth;if(setTotal>byteCount)
setCount=byteCount;else
setCount=setTotal;var startingLoc=((setCount/2)*-byteWidth)+byteWidth/2;var currLoc=startingLoc+x;var scale='';currentCharacters.forEach(function(character){if(character.getBBox().width>maxCharacterWidth){scale=' s'+maxCharacterWidth/character.getBBox().width+',1';}
character.transform('t'+currLoc+scale).attr({fill:color});currLoc+=byteWidth;scale='';});}
return{drawMessage:drawMessage};};}(jQuery));